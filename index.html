<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <title>Ho Chi Minh City Traffic Status</title>

  <style>
    #body-container {
      margin-top: 58px;
    }

    #map-container,
    #d1-container {
      margin: 3px;
      border: 3px solid black;
      background-color: #343a40;
    }

    #map-container table,
    #d1-container table {
      border-spacing: 0;
    }

    #map-container table td,
    #d1-container table td {
      margin: 0;
      padding: 0;
      display: inline-flex;
    }

    #d1-container table td img {
      width: 180px;
    }

    #map-container table td .status,
    #d1-container table td .status {
      position: absolute;
    }

    .map-label {
      color: white;
      padding-right: 5px;
    }

    #countdown {
      position: relative;
      height: 40px;
      width: 40px;
      text-align: center;
    }

    #countdown-number {
      color: white;
      display: inline-block;
      line-height: 40px;
    }

    svg {
      position: absolute;
      top: 0;
      right: 0;
      width: 40px;
      height: 40px;
      transform: rotateY(-180deg) rotateZ(-90deg);
    }

    svg circle {
      stroke-dasharray: 113px;
      stroke-dashoffset: 0px;
      stroke-linecap: round;
      stroke-width: 2px;
      stroke: white;
      fill: none;
      animation: countdown 30s linear infinite forwards;
    }

    @keyframes countdown {
      from {
        stroke-dashoffset: 0px;
      }

      to {
        stroke-dashoffset: 113px;
      }
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark d-flex justify-content-between fixed-top">
    <span class="navbar-brand mb-0 h1">Ho Chi Minh City Traffic Status</span>
    <div id="countdown">
      <div id="countdown-number"></div>
      <svg>
        <circle r="18" cx="20" cy="20"></circle>
      </svg>
    </div>
  </nav>
  <div id="body-container">
    <div id="map-container" class="d-flex justify-content-center align-items-center">
      <h1 class="map-label">City</h1>
      <table>
        <tbody>
          <tr>
            <td>
              <img src="./backgroundMap/11/1629_961.png" alt="">
              <img src="" alt="" id="1629_961" class="status">
            </td>
            <td>
              <img src="./backgroundMap/11/1630_961.png" alt="">
              <img src="" alt="" id="1630_961" class="status">
            </td>
            <td>
              <img src="./backgroundMap/11/1631_961.png" alt="">
              <img src="" alt="" id="1631_961" class="status">
            </td>
            <td>
              <img src="./backgroundMap/11/1632_961.png" alt="">
              <img src="" alt="" id="1632_961" class="status">
            </td>
          </tr>
          <tr>
            <td>
              <img src="./backgroundMap/11/1629_962.png" alt="">
              <img src="" alt="" id="1629_962" class="status">
            </td>
            <td>
              <img src="./backgroundMap/11/1630_962.png" alt="">
              <img src="" alt="" id="1630_962" class="status">
            </td>
            <td>
              <img src="./backgroundMap/11/1631_962.png" alt="">
              <img src="" alt="" id="1631_962" class="status">
            </td>
            <td>
              <img src="./backgroundMap/11/1632_962.png" alt="">
              <img src="" alt="" id="1632_962" class="status">
            </td>
          </tr>
          <tr>
            <td>
              <img src="./backgroundMap/11/1629_963.png" alt="">
              <img src="" alt="" id="1629_963" class="status">
            </td>
            <td>
              <img src="./backgroundMap/11/1630_963.png" alt="">
              <img src="" alt="" id="1630_963" class="status">
            </td>
            <td>
              <img src="./backgroundMap/11/1631_963.png" alt="">
              <img src="" alt="" id="1631_963" class="status">
            </td>
            <td>
              <img src="./backgroundMap/11/1632_963.png" alt="">
              <img src="" alt="" id="1632_963" class="status">
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div id="d1-container" class="d-flex justify-content-center align-items-center">
      <h1 class="map-label">D1</h1>
      <table>
        <tbody>
          <tr>
            <td>
              <img src="./backgroundMap/15_d1/26092_15395.png" alt="">
              <img src="" alt="" id="26092_15395" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26093_15395.png" alt="">
              <img src="" alt="" id="26093_15395" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26094_15395.png" alt="">
              <img src="" alt="" id="26094_15395" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26095_15395.png" alt="">
              <img src="" alt="" id="26095_15395" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26096_15395.png" alt="">
              <img src="" alt="" id="26096_15395" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26097_15395.png" alt="">
              <img src="" alt="" id="26097_15395" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26098_15395.png" alt="">
              <img src="" alt="" id="26098_15395" class="status">
            </td>
          </tr>
          <tr>
            <td>
              <img src="./backgroundMap/15_d1/26092_15396.png" alt="">
              <img src="" alt="" id="26092_15396" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26093_15396.png" alt="">
              <img src="" alt="" id="26093_15396" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26094_15396.png" alt="">
              <img src="" alt="" id="26094_15396" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26095_15396.png" alt="">
              <img src="" alt="" id="26095_15396" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26096_15396.png" alt="">
              <img src="" alt="" id="26096_15396" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26097_15396.png" alt="">
              <img src="" alt="" id="26097_15396" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26098_15396.png" alt="">
              <img src="" alt="" id="26098_15396" class="status">
            </td>
          </tr>
          <tr>
            <td>
              <img src="./backgroundMap/15_d1/26092_15397.png" alt="">
              <img src="" alt="" id="26092_15397" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26093_15397.png" alt="">
              <img src="" alt="" id="26093_15397" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26094_15397.png" alt="">
              <img src="" alt="" id="26094_15397" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26095_15397.png" alt="">
              <img src="" alt="" id="26095_15397" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26096_15397.png" alt="">
              <img src="" alt="" id="26096_15397" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26097_15397.png" alt="">
              <img src="" alt="" id="26097_15397" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26098_15397.png" alt="">
              <img src="" alt="" id="26098_15397" class="status">
            </td>
          </tr>
          <tr>
            <td>
              <img src="./backgroundMap/15_d1/26092_15398.png" alt="">
              <img src="" alt="" id="26092_15398" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26093_15398.png" alt="">
              <img src="" alt="" id="26093_15398" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26094_15398.png" alt="">
              <img src="" alt="" id="26094_15398" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26095_15398.png" alt="">
              <img src="" alt="" id="26095_15398" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26096_15398.png" alt="">
              <img src="" alt="" id="26096_15398" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26097_15398.png" alt="">
              <img src="" alt="" id="26097_15398" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26098_15398.png" alt="">
              <img src="" alt="" id="26098_15398" class="status">
            </td>
          </tr>
          <tr>
            <td>
              <img src="./backgroundMap/15_d1/26092_15399.png" alt="">
              <img src="" alt="" id="26092_15399" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26093_15399.png" alt="">
              <img src="" alt="" id="26093_15399" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26094_15399.png" alt="">
              <img src="" alt="" id="26094_15399" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26095_15399.png" alt="">
              <img src="" alt="" id="26095_15399" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26096_15399.png" alt="">
              <img src="" alt="" id="26096_15399" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26097_15399.png" alt="">
              <img src="" alt="" id="26097_15399" class="status">
            </td>
            <td>
              <img src="./backgroundMap/15_d1/26098_15399.png" alt="">
              <img src="" alt="" id="26098_15399" class="status">
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    var countdownNumberEl = document.getElementById('countdown-number');
    var countdown = 30;

    countdownNumberEl.textContent = countdown;

    setTimeout(function () {
      console.log('INIT')
      $.ajax({
        url: `/updateStatus`,
        type: "POST",
        data: '',

        success: function (data) {
          // resdata = JSON.parse(data)
          console.log('SUCCESSFUL UPDATED CITY STATUS', data)
          updateStatus(data.res)
        },
        error: function (error) {
          console.log('ERROR', error)
        }
      })

      $.ajax({
        url: `/updateD1Status`,
        type: "POST",
        data: '',

        success: function (data) {
          // resdata = JSON.parse(data)
          console.log('SUCCESSFUL UPDATED D1 STATUS', data)
          updateD1Status(data.res)
        },
        error: function (error) {
          console.log('ERROR', error)
        }
      })
    }, 1000)

    setInterval(function () {
      if (countdown == 1) {
        $.ajax({
          url: `/updateStatus`,
          type: "POST",
          data: '',

          success: function (data) {
            // resdata = JSON.parse(data)
            console.log('SUCCESSFUL UPDATED CITY STATUS', data)
            updateStatus(data.res)
          },
          error: function (error) {
            console.log('ERROR', error)
          }
        })

        $.ajax({
          url: `/updateD1Status`,
          type: "POST",
          data: '',

          success: function (data) {
            // resdata = JSON.parse(data)
            console.log('SUCCESSFUL UPDATED D1 STATUS', data)
            updateD1Status(data.res)
          },
          error: function (error) {
            console.log('ERROR', error)
          }
        })
      }
      countdown = --countdown <= 0 ? 30 : countdown;
      countdownNumberEl.textContent = countdown;
    }, 1000);

    function updateStatus(mapArr) {
      for (i = 0; i < 4; i++) {
        for (j = 0; j < 3; j++) {
          document.getElementById(mapArr[i][j][0]).src = mapArr[i][j][1];
        }
      }
    }

    function updateD1Status(mapArr) {
      for (i = 0; i < 6; i++) {
        for (j = 0; j < 4; j++) {
          document.getElementById(mapArr[i][j][0]).src = mapArr[i][j][1];
        }
      }
    }
  </script>
</body>

</html>